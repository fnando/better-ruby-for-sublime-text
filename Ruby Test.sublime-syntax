%YAML 1.2
---
name: Ruby Test
file_extensions:
  - Gemfile
first_line_match: ^#!/.*\bruby
scope: source.ruby.test
contexts:
  main:
    - include: 'scope:source.ruby'
    - match: (^\s*)(?=test\s+.*?\s+do$)
      push:
        - meta_scope: meta.ruby.test_case.test
        - match: ^\1(?=end)\b
          pop: true
        - include: 'scope:scope.ruby'
        - include: main
    - match: (^\s*)(?=def test_.*?$)
      push:
        - meta_scope: meta.ruby.test_case.test
        - match: ^\1(?=end)\b
          pop: true
        - include: 'scope:scope.ruby'
        - include: main
    - match: \brefute(_(empty|equal|includes|in_delta|in_epsilon|instance_of|kind_of|match|nil|operator|output|predicate|raises|respond_to|same|send|silence|throws))?\b
      scope: support.function.ruby.test
    - match: \bassert(_(empty|equal|includes|in_delta|in_epsilon|instance_of|kind_of|match|nil|operator|predicate|respond_to|same))?\b
      scope: support.function.ruby.test
    - match: \b(flunk|skip|capture_io|capture_subprocess_io|test)\b
      scope: support.function.ruby.test
    - match: \b(visit|click_on|click_button|click_link|fill_in|check|uncheck|select|choose|attach_file|page)\b
      scope: support.function.ruby.test.capybara
